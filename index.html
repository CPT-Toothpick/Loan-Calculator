<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Amortization Calculator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 2rem;
        }
        .header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .header h1 {
            color: #1e40af;
            font-size: 2rem;
            flex: 1;
        }
        .button-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        .btn-excel {
            background: #16a34a;
            color: white;
        }
        .btn-excel:hover {
            background: #15803d;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(22, 163, 74, 0.4);
        }
        .btn-csv {
            background: #2563eb;
            color: white;
        }
        .btn-csv:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }
        .section {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .section h2 {
            color: #374151;
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        .input-group label {
            display: block;
            color: #6b7280;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        .input-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        .input-group input:focus {
            outline: none;
            border-color: #6366f1;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        .summary-card {
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            overflow: hidden;
        }
        .summary-card.indigo {
            background: #eef2ff;
        }
        .summary-card.green {
            background: #f0fdf4;
        }
        .summary-card.blue {
            background: #eff6ff;
        }
        .summary-card.purple {
            background: #faf5ff;
        }
        .summary-label {
            color: #6b7280;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        .summary-value {
            font-size: 1.5rem;
            font-weight: bold;
            word-break: break-word;
        }
        @media (max-width: 480px) {
            .summary-value {
                font-size: 1.25rem;
            }
            .summary-label {
                font-size: 0.8rem;
            }
        }
        .summary-value.indigo {
            color: #6366f1;
        }
        .summary-value.green {
            color: #16a34a;
        }
        .summary-value.blue {
            color: #2563eb;
        }
        .summary-value.purple {
            color: #9333ea;
        }
        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        thead {
            background: #4f46e5;
            color: white;
        }
        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
        }
        th.text-right {
            text-align: right;
        }
        tbody tr:nth-child(even) {
            background: #f9fafb;
        }
        tbody tr:hover {
            background: #f3f4f6;
        }
        td {
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            border-bottom: 1px solid #e5e7eb;
        }
        td.text-right {
            text-align: right;
        }
        td.text-center {
            text-align: center;
        }
        td.principal {
            color: #2563eb;
        }
        td.interest {
            color: #dc2626;
        }
        tfoot {
            background: #f3f4f6;
            font-weight: 600;
        }
        tfoot td {
            padding: 1rem;
            border-top: 2px solid #9ca3af;
        }
        .icon {
            width: 20px;
            height: 20px;
        }
        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }
            .container {
                padding: 1rem;
            }
            .header h1 {
                font-size: 1.5rem;
            }
            button {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useMemo } = React;

        const LoanAmortization = () => {
          const [loanBalance, setLoanBalance] = useState(31536);
          const [annualRate, setAnnualRate] = useState(3);
          const [monthlyPayment, setMonthlyPayment] = useState(1767.89);

          const schedule = useMemo(() => {
            const monthlyRate = annualRate / 100 / 12;
            let balance = loanBalance;
            const payments = [];
            let month = 1;
            let totalInterest = 0;
            let totalPrincipal = 0;

            while (balance > 0.01 && month <= 60) {
              const interestPayment = balance * monthlyRate;
              const principalPayment = Math.min(monthlyPayment - interestPayment, balance);
              const actualPayment = principalPayment + interestPayment;
              const endingBalance = balance - principalPayment;

              totalInterest += interestPayment;
              totalPrincipal += principalPayment;

              payments.push({
                month,
                beginningBalance: balance,
                payment: actualPayment,
                principal: principalPayment,
                interest: interestPayment,
                endingBalance: Math.max(0, endingBalance)
              });

              balance = endingBalance;
              month++;

              if (balance <= 0) break;
            }

            return { payments, totalInterest, totalPrincipal };
          }, [loanBalance, annualRate, monthlyPayment]);

          const formatCurrency = (value) => {
            return new Intl.NumberFormat('en-US', {
              style: 'currency',
              currency: 'USD',
              minimumFractionDigits: 0,
              maximumFractionDigits: 0
            }).format(value);
          };

          const getPayoffDate = (monthsFromNow) => {
            const date = new Date(2026, 0, 1);
            date.setMonth(date.getMonth() + monthsFromNow);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
          };

          const downloadCSV = () => {
            let csv = 'Month,Date,Beginning Balance,Payment,Principal,Interest,Ending Balance\n';
            
            schedule.payments.forEach((payment) => {
              csv += `${payment.month},${getPayoffDate(payment.month - 1)},${payment.beginningBalance.toFixed(2)},${payment.payment.toFixed(2)},${payment.principal.toFixed(2)},${payment.interest.toFixed(2)},${payment.endingBalance.toFixed(2)}\n`;
            });
            
            csv += `\nTotals,,${loanBalance.toFixed(2)},${schedule.payments.reduce((sum, p) => sum + p.payment, 0).toFixed(2)},${schedule.totalPrincipal.toFixed(2)},${schedule.totalInterest.toFixed(2)},0.00\n`;
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'loan_amortization_schedule.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
          };

          const downloadExcel = async () => {
            try {
              if (!window.XLSX) {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js';
                
                await new Promise((resolve, reject) => {
                  script.onload = resolve;
                  script.onerror = reject;
                  document.head.appendChild(script);
                });
              }
              
              const XLSX = window.XLSX;
              const wb = XLSX.utils.book_new();
              
              const inputData = [
                ['Loan Amortization Calculator', ''],
                ['', ''],
                ['Input Parameters', ''],
                ['Starting Loan Balance', loanBalance],
                ['Annual Interest Rate (%)', annualRate],
                ['Monthly Payment (P&I)', monthlyPayment],
                ['Monthly Interest Rate', annualRate/100/12],
                ['', ''],
                ['Summary', ''],
                ['Months to Payoff', schedule.payments.length],
                ['Total Interest Paid', schedule.totalInterest],
                ['Total Principal Paid', schedule.totalPrincipal],
                ['Estimated Payoff Date', getPayoffDate(schedule.payments.length - 1)]
              ];
              
              const scheduleData = [
                ['Month', 'Date', 'Beginning Balance', 'Payment', 'Principal', 'Interest', 'Ending Balance'],
              ];
              
              for (let i = 1; i <= 60; i++) {
                const row = i;
                
                if (i === 1) {
                  scheduleData.push([
                    i,
                    getPayoffDate(i - 1),
                    { f: 'Inputs!B4' },
                    { f: 'Inputs!B6' },
                    { f: `D${row+1}-F${row+1}` },
                    { f: `C${row+1}*Inputs!B7` },
                    { f: `C${row+1}-E${row+1}` }
                  ]);
                } else {
                  scheduleData.push([
                    i,
                    getPayoffDate(i - 1),
                    { f: `IF(G${row},G${row},0)` },
                    { f: `IF(C${row+1}>0,Inputs!B6,0)` },
                    { f: `IF(C${row+1}>0,MIN(D${row+1}-F${row+1},C${row+1}),0)` },
                    { f: `IF(C${row+1}>0,C${row+1}*Inputs!B7,0)` },
                    { f: `IF(C${row+1}>0,MAX(C${row+1}-E${row+1},0),0)` }
                  ]);
                }
              }
              
              scheduleData.push([
                'TOTALS',
                '',
                '',
                { f: 'SUM(D2:D61)' },
                { f: 'SUM(E2:E61)' },
                { f: 'SUM(F2:F61)' },
                ''
              ]);
              
              const wsInputs = XLSX.utils.aoa_to_sheet(inputData);
              const wsSchedule = XLSX.utils.aoa_to_sheet(scheduleData);
              
              wsInputs['!cols'] = [{ wch: 28 }, { wch: 18 }];
              wsSchedule['!cols'] = [
                { wch: 8 }, { wch: 14 }, { wch: 20 }, { wch: 14 },
                { wch: 16 }, { wch: 14 }, { wch: 20 }
              ];
              
              XLSX.utils.book_append_sheet(wb, wsInputs, 'Inputs');
              XLSX.utils.book_append_sheet(wb, wsSchedule, 'Amortization Schedule');
              
              XLSX.writeFile(wb, 'loan_amortization.xlsx');
            } catch (error) {
              console.error('Error creating Excel file:', error);
              alert('Error creating Excel file. Please try the CSV download instead.');
            }
          };

          return (
            <div className="container">
              <div className="header">
                <h1>ðŸ’° Loan Amortization Schedule</h1>
                <div className="button-group">
                  <button onClick={downloadExcel} className="btn-excel">
                    ðŸ“Š Download Excel
                  </button>
                  <button onClick={downloadCSV} className="btn-csv">
                    ðŸ“¥ Download CSV
                  </button>
                </div>
              </div>

              <div className="section">
                <h2>Loan Parameters</h2>
                <div className="input-grid">
                  <div className="input-group">
                    <label>Current Balance ($)</label>
                    <input
                      type="number"
                      value={loanBalance}
                      onChange={(e) => setLoanBalance(parseFloat(e.target.value) || 0)}
                    />
                  </div>
                  <div className="input-group">
                    <label>Annual Interest Rate (%)</label>
                    <input
                      type="number"
                      step="0.01"
                      value={annualRate}
                      onChange={(e) => setAnnualRate(parseFloat(e.target.value) || 0)}
                    />
                  </div>
                  <div className="input-group">
                    <label>Monthly Payment ($)</label>
                    <input
                      type="number"
                      step="0.01"
                      value={monthlyPayment}
                      onChange={(e) => setMonthlyPayment(parseFloat(e.target.value) || 0)}
                    />
                  </div>
                </div>
              </div>

              <div className="section">
                <h2>Summary</h2>
                <div className="summary-grid">
                  <div className="summary-card indigo">
                    <div className="summary-label">Months to Payoff</div>
                    <div className="summary-value indigo">{schedule.payments.length}</div>
                  </div>
                  <div className="summary-card green">
                    <div className="summary-label">Total Interest</div>
                    <div className="summary-value green">{formatCurrency(schedule.totalInterest)}</div>
                  </div>
                  <div className="summary-card blue">
                    <div className="summary-label">Total Principal</div>
                    <div className="summary-value blue">{formatCurrency(schedule.totalPrincipal)}</div>
                  </div>
                  <div className="summary-card purple">
                    <div className="summary-label">Payoff Date</div>
                    <div className="summary-value purple">{getPayoffDate(schedule.payments.length - 1)}</div>
                  </div>
                </div>
              </div>

              <div className="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Month</th>
                      <th>Date</th>
                      <th className="text-right">Beginning Balance</th>
                      <th className="text-right">Payment</th>
                      <th className="text-right">Principal</th>
                      <th className="text-right">Interest</th>
                      <th className="text-right">Ending Balance</th>
                    </tr>
                  </thead>
                  <tbody>
                    {schedule.payments.map((payment, index) => (
                      <tr key={index}>
                        <td className="text-center">{payment.month}</td>
                        <td>{getPayoffDate(payment.month - 1)}</td>
                        <td className="text-right">{formatCurrency(payment.beginningBalance)}</td>
                        <td className="text-right">{formatCurrency(payment.payment)}</td>
                        <td className="text-right principal">{formatCurrency(payment.principal)}</td>
                        <td className="text-right interest">{formatCurrency(payment.interest)}</td>
                        <td className="text-right">{formatCurrency(payment.endingBalance)}</td>
                      </tr>
                    ))}
                  </tbody>
                  <tfoot>
                    <tr>
                      <td colSpan="3">Totals</td>
                      <td className="text-right">{formatCurrency(schedule.payments.reduce((sum, p) => sum + p.payment, 0))}</td>
                      <td className="text-right principal">{formatCurrency(schedule.totalPrincipal)}</td>
                      <td className="text-right interest">{formatCurrency(schedule.totalInterest)}</td>
                      <td className="text-right">$0.00</td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LoanAmortization />);
    </script>
</body>
</html>
